<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="stylesheet" href="./assets/style.css" />
  <title>アイテム詳細</title>

  <link rel="icon" href="./assets/icon.svg" type="image/svg+xml" />
  <link rel="apple-touch-icon" href="./assets/icon-192.png" />
  <link rel="manifest" href="./manifest.webmanifest" />
  <meta name="theme-color" content="#e8892f" />  <meta name="description" content="DQ7R のアイテム詳細ページ。" />
</head>
<body>
<main>
<div class="card" style="margin-bottom:12px;"><h1 style="margin-bottom:6px;">アイテム詳細</h1><p>アイテムの詳細情報を表示します。URLの <span class="mono">?id=</span> を指定すると該当ページを開けます。</p><p class="small">※非公式ファンサイトです。掲載情報は参考用です。</p></div>
  <div id="wrap"></div>
</main>

<footer>
  <div class="footer-inner">
    <div class="footer-note">
      <div class="footer-links">
        <a href="./about.html">このサイトについて</a>
        <a href="./privacy.html">プライバシーポリシー</a>
        <a href="./contact.html">お問い合わせ</a>
      </div>
      <div class="small" style="margin-top:6px;">※非公式ファンサイトです。掲載情報は参考用です。</div>
    </div>
    <div class="footer-copy small">© 2026 DQ7R データベース</div>
  </div>
</footer>

<script type="module">
  import { boot } from "./assets/app_common.js";
  import { loadCSV, byId } from "./assets/data.js";
  import { getParam, escapeHTML } from "./assets/util.js";

  boot("アイテム詳細 | DQ7R");

  const id = getParam("id") || "";
  const WRAP = document.getElementById("wrap");

  async function main(){
    if (!id){
      WRAP.innerHTML = `<section class="card"><h1>アイテム詳細</h1><div class="warn">URLに <span class="mono">?id=item_001</span> のように指定してください。</div><p><a href="./items.html">← アイテム一覧へ</a></p></section>`;
      return;
    }

    const items = await loadCSV("./data/current/items.csv");
    const it = byId(items, "item_id", id);

    if (!it){
      WRAP.innerHTML = `<section class="card"><h1>アイテム詳細</h1><div class="warn">id=${escapeHTML(id)} が見つかりません。</div><p><a href="./items.html">← アイテム一覧へ</a></p></section>`;
      return;
    }

    document.title = `${it.name || it.item_id} | アイテム詳細`;

    WRAP.innerHTML = `
      <section class="card">
        <h1>${escapeHTML(it.name || "")}</h1>
        <div class="small mono">${escapeHTML(it.item_id || "")}</div>

        <p>
          <b>カテゴリ：</b>${escapeHTML(it.category || "")}<br>
          <b>部位/種別：</b>${escapeHTML(it.slot || "")}
          ${ (it.era||"").trim() ? `<br><b>時代：</b>${escapeHTML(it.era || "")}` : `` }
          ${ (it.obtain||"").trim() ? `<br><b>入手：</b>${escapeHTML(it.obtain || "")}` : `` }

        </p>

        <p>
          <b>攻撃：</b>${escapeHTML(it.atk || "")}　
          <b>防御：</b>${escapeHTML(it.def || "")}
        </p>

        <p>
          <b>買値：</b>${escapeHTML(it.price_buy || "")}　
          <b>売値：</b>${escapeHTML(it.price_sell || "")}
        </p>

        <p><b>効果</b><br>${escapeHTML(it.effect || "")}</p>
        <p><b>メモ</b><br>${escapeHTML(it.notes || "")}</p>

        <p class="small"><a href="./items.html">← アイテム一覧へ戻る</a></p>
      </section>
    `;
  }

  main().catch(err=>{
    WRAP.innerHTML = `<section class="card"><h1>アイテム詳細</h1><div class="warn">${escapeHTML(err.message || String(err))}</div><p><a href="./items.html">← アイテム一覧へ</a></p></section>`;
  });
</script>
</body>
</html>
